
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Simplifying the Landscape - HarveyNick.com</title>
  <meta name="author" content="Nick Johnson">

  
  <meta name="description" content="At the end of the last post I wrote about the actual implementation of my Clockwork Aphid project, I said the next step was going to be display &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.harveynick.com/blog/2011/12/01/simplifying-the-landscape">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/Harveynick" rel="alternate" title="HarveyNick.com" type="application/atom+xml">
    <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
  <!--link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"-->
  <!--link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"-->

  <!--link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
  <!--link href='http://fonts.googleapis.com/css?family=Cabin' rel='stylesheet' type='text/css'-->
  <!--link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'-->
  <!--link href='http://fonts.googleapis.com/css?family=Gentium+Book+Basic' rel='stylesheet' type='text/css'-->
  <!--link href='http://fonts.googleapis.com/css?family=Lobster+Two:700italic' rel='stylesheet' type='text/css'-->
  <link href='http://fonts.googleapis.com/css?family=Lobster|Ubuntu+Condensed|Gentium+Book+Basic' rel='stylesheet' type='text/css'>

  <!-- For third-generation iPad with high-resolution Retina display: -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="apple-touch-icon-144x144-precomposed.png">
  <!-- For iPhone with high-resolution Retina display: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-114x114-precomposed.png">
  <!-- For first- and second-generation iPad: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon-72x72-precomposed.png">
  <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="apple-touch-icon-57x57-precomposed.png">


  <meta name="readability-verification" content="QUKCyxBsSkBLBb9EV6af7hEy2dheS7xF48kQqvNr"/>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28082281-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38508260-1']);
  _gaq.push(['_setDomainName', 'adsensechallenge.com']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">HarveyNick.com</a></h1>
  
    <h2>Something nerdy this way comes.</h2>
  
</hgroup>

</header>
  <!--div class="headerscaffold"></div-->
  <div id="shadow"></div>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/Harveynick" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.harveynick.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Simplifying the Landscape</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-01T09:28:05+00:00" pubdate data-updated="true">Dec 1<span>st</span>, 2011</time>
        
         | <a href="#disqus_thread">Comments</a>
        
        
          
        
      </p>
    
  </header>


<div class="entry-content"><p>At the end of the <a href="/blog/2010/10/22/now-in-eye-popping-3d/">last post</a> I wrote about the actual implementation of my Clockwork Aphid project, I said the next step was going to be display simplification. At that point I&#8217;d generated a few landscapes which were just starting barely starting to test the limits of my computer, though they were nothing like the size or complexity I had in mind. That said, it was looking at landscapes containing 1579008 polygons and it was obvious that not all of these needed to be put on screen. Moreover, because my landscapes are essentially made up of discrete samples (or nodes): I needed to reduce the number of samples which were displayed to the user, otherwise my performance was really going to tank as the landscapes increased in size.</p>

<!-- more -->


<p>Shamus Young talked about terrain simplification <a href="http://www.shamusyoung.com/twentysidedtale/?p=142">some time ago</a> during his original terrain project. This seemed as good a place as any to start, so I grabbed a copy of <a href="http://citeseer.ist.psu.edu/viewdoc/summary?doi=10.1.1.14.4771">the paper</a> he used to build his algorithm. I didn&#8217;t find it as complicated as it appears he did, but this is probably because I&#8217;m more used to reading papers like this (I must have read hundreds during my PhD, and even wrote a couple), so I&#8217;m reasonably fluent in academicese. It was, as I suspected, a good starting point, though I wouldn&#8217;t be able to use the algorithm wholesale as it&#8217;s not directly compatible with the representation I&#8217;m using. Happily, my representation does make it very simple to use the core idea, though.</p>

<p>If you <a href="/blog/2010/10/19/youre-speaking-my-landscape-baby/">remember</a>, my representation stores the individual points in a sparse array, indexed using fractional coordinates. This makes it very flexible, and allows me to use an irregular level of detail (more on that later). Unlike the representation used in the paper, this means a can&#8217;t make optimisations based on the assumption that my data is stored in a regular grid. Thankfully, the first stage of the simplification algorithm doesn&#8217;t care about this and examines points individually. Also thankfully, the simplification algorithm uses the same parent/child based tessellation strategy that I do.</p>

<p>The first step is decide which points are &#8220;active&#8221;. This is essentially based on two variables:</p>

<ul>
<li>The amount of &#8220;object space error&#8221; a point has (i.e. how much it differs from its parents);</li>
<li>The distance between the point and the &#8220;camera&#8221;.</li>
</ul>


<p>A local constant is also present for each point:</p>

<ul>
<li>The point&#8217;s bounding radius, or the distance to its furthest child (if it has children);</li>
</ul>


<p>I&#8217;m not sure if I actually need this last in my current implementation (my gut says no, I&#8217;ll explain why later), but I&#8217;m leaving it in for the time being. Finally, two global constants are used for tuning, and we end up with this:</p>

<p><img class="center" src="http://harveynick.files.wordpress.com/2011/12/simplificationequation21.png"></p>

<p>Where:</p>

<ul>
<li><em>i</em> = the point in question</li>
<li><em>λ</em> = a constant</li>
<li><em>ε<sub>i</sub></em> = the object space error of <em>i</em></li>
<li><em>d<sub>i</sub></em> = the distance between <em>i</em> and the camera</li>
<li><em>r<sub>i</sub></em> = the bounding radius of <em>i</em></li>
<li><em>τ</em> = another constant</li>
</ul>


<p>This is not entirely optimal for processing, but a little bit of maths wizardry transforms this like so:</p>

<p><img class="center" src="http://harveynick.files.wordpress.com/2011/12/simplificationequation31.png"></p>

<p>This looks more complicated, and it&#8217;s less intuitive to see what it actually does, but from the point of view of the computer it&#8217;s a lot simpler, as it avoids the square root needed to calculate the distance between the point and the camera. Now we get to the fun part: diagrams! Consider the following small landscape, coloured as to the granularity of each of the points (aka the distance to the node&#8217;s parents, see <a href="/blog/2010/10/22/fractal-errata/">this post</a>):</p>

<p><img class="center" src="http://harveynick.files.wordpress.com/2011/12/allpoints.jpg"></p>

<p>Next, we&#8217;ll pick some arbitrary values for the constants mentioned above (ones which work well for explanatory purposes), and place the viewpoint in the top left hand corner, and we end up with this the following active points (inactive points are hidden):</p>

<p><img class="center" src="http://harveynick.files.wordpress.com/2011/12/activepoints.jpg"></p>

<p>Now, we take the active points with the smallest granularity, and we have them draw their polygons, <a href="/blog/2010/10/22/now-in-eye-popping-3d/">exactly as before</a>, which looks like this:</p>

<p><img class="center" src="http://harveynick.files.wordpress.com/2011/12/smallestpolygons.jpg"></p>

<p>When we come to draw the polygons of the next highest granularity you&#8217;ll see that we have a problem, though. The previous set of polygons have encroached on their territory. To avoid this, each node informs its parents that it is active and then the parent doesn&#8217;t draw any polygons in the direction of its active children. If we add in the polygons drawn by the each of the other levels of granularity, we now end up with this:</p>

<p><img class="center" src="http://harveynick.files.wordpress.com/2011/12/filledpolygons.jpg"></p>

<p>Oh no! There&#8217;s a hole in my landscape! I was actually expecting that my simplistic approach would lead to more or less this result, but it was still a little annoying when it happened. If I was a proper analytical type I would next have sat down and worked over the geometry at play here, then attempted to find a formulation which would prevent this from happening. Instead, though, I stared at it for a good long while, displaying it in various different ways, and waited for something to jump out at me.</p>

<p>Eventually it did, and thankfully it was a very simple rule. Each parent stores a list of the directions in which it has active children in order to prevent overdrawing (as mentioned above). The new rule is that a node is also considered active if this list is non-empty. With this addition, our tessellated landscape now look alike this:</p>

<p><img class="center" src="http://harveynick.files.wordpress.com/2011/12/backfilledpolygons.jpg"></p>

<p>Presto! A nice simple rule which fills in all of the gaps in the landscape without any over or under simplification, or any overdrawing. I suspect this rule also negates the need for the bounding radius mentioned above, though I have not as yet tested that thought. To recap, we have three simple rules:</p>

<ol>
<li>A node is active if the object space error/distance equation says it is;</li>
<li>A node is active if any of its children are active;</li>
<li>Polygons are tessellated for each active point, but not in the direction of any active children.</li>
</ol>


<p>But what does this look like in actual eye poppingly 3D landscapes? Well, here&#8217;s an example, using the height based colouring I&#8217;ve used before:</p>

<p><img class="center" src="http://harveynick.files.wordpress.com/2011/12/simplifiedlandscape.jpg"><!-- header_img http://harveynick.files.wordpress.com/2011/12/simplifiedlandscape.jpg --></p>

<p>I&#8217;m quite pleased with this, though what I&#8217;m doing here is still quite inefficient and in need of some serious tuning. There are a couple of further simplification tricks I can try (including the next step from the (paper) paper). More to come later. Honest.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">harveynick</span></span>

      








  


<time datetime="2011-12-01T09:28:05+00:00" pubdate data-updated="true">Dec 1<span>st</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/hacker/'>Hacker</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.harveynick.com/blog/2011/12/01/simplifying-the-landscape/" data-via="harveynick" data-counturl="http://www.harveynick.com/blog/2011/12/01/simplifying-the-landscape/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/09/20/mercury-rising/" title="Previous Post: Mercury Rising">&laquo; Mercury Rising</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/03/17/new-ish-year-new-ish-blog/" title="next Post: New (ish) Year, New (ish) Blog">New (ish) Year, New (ish) Blog &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <!-- h1>A Little Bit About Me</h1-->
  <br/>
  <p>This is the personal site of <a href="/about">Nick Johnson</a>, who is, among other things: 
  
    
    
    
  	  a <a href="/blog/categories/blogger">blogger</a>,
    
  
    
    
    
  	  an <a href="/blog/categories/audiophile">audiophile</a>,
    
  
    
    
    
  	  a <a href="/blog/categories/geek">geek</a>,
    
  
    
    
    
  	  a <a href="/blog/categories/hacker">hacker</a>,
    
  
    
    
    
  	  a <a href="/blog/categories/globetrotter">globetrotter</a>,
    
  
    
    
    
  	  a <a href="/blog/categories/foodie">foodie</a>,
    
  
    
    
    
  	  a <a href="/blog/categories/bibliophile">bibliophile</a>,
    
  
    
    
    
  	  a <a href="/blog/categories/cinephile">cinephile</a>,
    
  
    
    
    
      and a <a href="/blog/categories/gym-rat">gym rat</a>.
    
  
  <p><center><img src="http://www.gravatar.com/avatar/1eb55935486442c1e2b2455f85b9a771?s=140" width="140" height="140" /></center></p>
  </p>
</section>
<section>
  <div id="side-ad">
      <script type="text/javascript"><!--
        google_ad_client = "ca-pub-5573133722944342";
        /* Blog Sidebar */
        google_ad_slot = "3775287017";
        google_ad_width = 200;
        google_ad_height = 200;
        //-->
        </script>
        <script type="text/javascript"
        src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
  </div>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/04/19/perilously-close-to-perfection/">Perilously Close to Perfection</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/07/running-the-first-time/">Running, The First Time</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/01/a-fitness-story/">A Fitness Story</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/25/categories-and-goals/">Categories and Goals</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/22/ch-ch-ch-changes/">Ch-Ch-Ch-Changes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/17/i-disagree-with-film-critic-hulk/">I Disagree with Film Critic Hulk</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/17/wandering-around-london/">Wandering Around London</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/04/14/now-were-blogging-with-photos/">Now We're Blogging with Photos!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/27/origin/">Origin Story, Raspberry Pi, and the ZX Spectrum</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/17/new-ish-year-new-ish-blog/">New (ish) Year, New (ish) Blog</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("harveynick", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/harveynick" class="twitter-follow-button" data-show-count="false">Follow @harveynick</a>
  
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Nick Johnson -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'harveynick-com';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.harveynick.com/blog/2011/12/01/simplifying-the-landscape/';
        var disqus_url = 'http://www.harveynick.com/blog/2011/12/01/simplifying-the-landscape/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
